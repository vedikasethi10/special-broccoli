<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    let currentChart = null;

    async function loadData() {
        const currentResponse = await fetch('current_prices.json');
        const currentData = await currentResponse.json();
        const currentTable = document.getElementById('currentPrices');
        currentTable.innerHTML = '<tr><th>Symbol</th><th>Price</th><th>Last Updated</th></tr>';
        currentData.forEach(item => {
            const row = currentTable.insertRow();
            row.insertCell(0).innerText = item.symbol;
            row.insertCell(1).innerText = item.current_price;
            row.insertCell(2).innerText = item.last_updated;
        });

        const stocks = currentData.map(item => item.symbol.replace('.NS', ''));
        const stockList = document.getElementById('stockList');
        stockList.innerHTML = '';
        stocks.forEach(stock => {
            const div = document.createElement('div');
            div.className = 'stock-item';
            div.innerText = stock;
            div.onclick = () => loadHistoricalData(stock);
            stockList.appendChild(div);
        });
    }

    async function loadHistoricalData(stock) {
        const histResponse = await fetch(`${stock.toLowerCase()}_history.json`);
        const histData = await histResponse.json();
        const dates = histData.map(item => item.Date);
        const prices = histData.map(item => item.Close);

        if (currentChart) currentChart.destroy();

        const ctx = document.getElementById('historicalChart').getContext('2d');
        currentChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [{
                    label: 'Close Price',
                    data: prices,
                    borderColor: 'blue',
                    fill: false
                }]
            },
            options: {
                scales: { x: { title: { display: true, text: 'Date' } }, y: { title: { display: true, text: 'Price (INR)' } } },
                plugins: { legend: { position: 'top' } }
            }
        });
    }

    function filterStocks() {
        const input = document.getElementById('stockSearch').value.toLowerCase();
        const stockItems = document.getElementsByClassName('stock-item');
        for (let item of stockItems) {
            if (item.innerText.toLowerCase().includes(input)) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        }
    }

    function refreshData() {
        location.reload();
    }

    window.onload = loadData;
</script>
        window.onload = loadData;
    </script>
</body>
</html>
